package main

import (
	"encoding/json"
	"fmt"
	"go-test/intchain/config"
	"go-test/intchain/utils"
)

type extraDataParams struct {
	ExtraData string `json:"extra_data"`
}

//curl -X POST --data '{"jsonrpc":"2.0","method":"tdm_decodeExtraData","params":["0x0108696e74636861696e0000000000002c0615cd7d205898b7400000000000000000000201149d2b5214e24104f648819a2b851970e02e0f73c50114dae66c6bca991012f6f62d4db42c79c60e3c2e44010114980aaa734720bdc9d93e3d4030a135aec4910bac0000000000000001011415a43260d301c016d636ec117eac56578f1157990000000000002c06000140439243a34a9ef90323f7db46d7800b7049fa4a50599956054d716de1cf37f7dc686c8a5c6510a17609cda05dd53737cc8635f15da4f7f48ccc1c288db0960e730100000000000000010101000000000000000100"],"id":1}' -H 'content-type: application/json;' http://127.0.0.1:7000/intchain
func main() {
	extraData, err := decodeExtraData()
	if err != nil {
		fmt.Printf("decode extra data err %v\n", err)
	} else {
		fmt.Printf("extra data %v\n", extraData)
	}

}

//0x0108696e74636861696e0000000000036d2215d1c5946affe280000000000000000000200114655cd331d1e1efdd64a6685572dbb7c2e55d94230114ec299e752fd4b41f0ea3d5a4e2b350e6f3a1471b0101143a5a129a82054e0a196f6d9814752d6b5c5de64000000000000000010114cc757fcbcfe9d13fd7f135240a99786c2b7c5c060000000000036d22010201402b224d54b9d4e533640f7fbb4528b0399ff3f0a34f15de4a0d0a19db9af61c3a100e6ddf31128f02213ea3b9aef8c233dc1807e558eccf3dd6f61f6875859de70100000000000000030101000000000000000300
//0x0108696e74636861696e000000000003713d15d1c7c6c2488b8000000000000000000020011415d14546048c69022a12e0c8605338e68a841fb30114ec299e752fd4b41f0ea3d5a4e2b350e6f3a1471b010114ca95018425ce58d2e041eb5d9eda115f181214f800000000000000010114f4fd5d4e44794f67fa797f7824dd706934970e3c000000000003713d010201405678a97feace6079d60753d636ad7358349fcd2b222e1ffff393359f2c272e5d132f435b18967010e881db0dc52055c8c50ff0ac660195c494aa85a7015c7de30100000000000000030101000000000000000300
func decodeExtraData() (extraData interface{}, err error) {
	var r config.ExtraDataRPC
	params := extraDataParams{
		ExtraData: "0x0108696e74636861696e0000000000036d2215d1c5946affe280000000000000000000200114655cd331d1e1efdd64a6685572dbb7c2e55d94230114ec299e752fd4b41f0ea3d5a4e2b350e6f3a1471b0101143a5a129a82054e0a196f6d9814752d6b5c5de64000000000000000010114cc757fcbcfe9d13fd7f135240a99786c2b7c5c060000000000036d22010201402b224d54b9d4e533640f7fbb4528b0399ff3f0a34f15de4a0d0a19db9af61c3a100e6ddf31128f02213ea3b9aef8c233dc1807e558eccf3dd6f61f6875859de70100000000000000030101000000000000000300",
	}

	postData := map[string]interface{}{
		"jsonrpc": "2.0",
		"method":  "tdm_decodeExtraData",
		"params":  []interface{}{params.ExtraData},
		"id":      "1",
	}

	resp, err := utils.RpcRequest(postData)
	if err != nil {
		return "", err
	}

	err = json.Unmarshal([]byte(resp.Body), &r)
	if err != nil {
		return "", err
	} else {
		return r.Result, nil
	}
}
